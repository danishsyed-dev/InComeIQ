{% extends "base.html" %}
{% block title %}InComeIQ — Prediction Result{% endblock %}

{% block content %}
<div class="card" style="padding: 0; overflow: hidden;">

    <!-- ── Result Hero ──────────────────────────────────────── -->
    <div class="result-hero result-{{ result_class }}">

        <!-- SVG Icon -->
        <div class="result-icon-wrap">
            {% if result_class == 'positive' %}
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <line x1="12" y1="1" x2="12" y2="23" />
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
            </svg>
            {% else %}
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
            </svg>
            {% endif %}
        </div>

        <!-- Headline -->
        <h1 class="result-headline" aria-live="polite">{{ prediction }}</h1>

        <!-- Subtitle -->
        <p class="result-sub">
            Predicted using <strong style="color: var(--text-secondary);">{{ model_label }}</strong>
        </p>

        <!-- Confidence bar -->
        {% if prob_pct %}
        <div class="confidence-wrap">
            <div class="confidence-header">
                <span>Confidence</span>
                <strong>{{ probability }}</strong>
            </div>
            <div class="confidence-bar" role="progressbar" aria-valuenow="{{ prob_pct }}" aria-valuemin="0"
                aria-valuemax="100" aria-label="Prediction confidence {{ probability }}">
                <div class="confidence-fill" id="confidence-fill" data-pct="{{ prob_pct }}%"></div>
            </div>
        </div>
        {% endif %}

    </div>

    <hr class="result-divider">

    <!-- ── Input Summary ────────────────────────────────────── -->
    {% if input_summary %}
    <details class="summary-details" id="input-summary">
        <summary>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
                <line x1="16" y1="13" x2="8" y2="13" />
                <line x1="16" y1="17" x2="8" y2="17" />
                <polyline points="10 9 9 9 8 9" />
            </svg>
            Your Inputs
            <svg class="summary-chevron" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <polyline points="6 9 12 15 18 9" />
            </svg>
        </summary>

        <dl class="summary-table">
            {% for key, value in input_summary.items() %}
            <div class="summary-row">
                <dt>{{ key }}</dt>
                <dd>{{ value }}</dd>
            </div>
            {% endfor %}
        </dl>
    </details>

    <hr class="result-divider">
    {% endif %}

    <!-- ── Feature Importance ────────────────────────────────── -->
    <div class="feature-panel">
        <p class="feature-panel-title">Why this prediction?</p>
        <p class="feature-panel-sub">Top features that influenced the model's decision.</p>

        {% if plot_filename %}
        <img src="{{ url_for('static', filename=plot_filename) }}"
            alt="Feature importance chart showing which inputs most influenced the prediction" class="feature-plot"
            loading="lazy">
        {% else %}
        <p class="feature-empty">Feature importance is not available for this model or configuration.</p>
        {% endif %}
    </div>

    <hr class="result-divider">

    <!-- ── CTA Actions ───────────────────────────────────────── -->
    <div class="result-actions">
        <a href="/" class="btn btn-ghost">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <line x1="19" y1="12" x2="5" y2="12" />
                <polyline points="12 19 5 12 12 5" />
            </svg>
            Predict Again
        </a>

        <button id="copy-result-btn" class="btn btn-ghost"
            data-result="InComeIQ Prediction: {{ prediction }} (Confidence: {{ probability }}, Model: {{ model_label }})"
            type="button">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
            </svg>
            Copy Result
        </button>

        <span class="copy-feedback" id="copy-feedback" aria-live="polite">Copied!</span>
    </div>

</div>
{% endblock %}